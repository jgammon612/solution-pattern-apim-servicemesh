<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Provision BookInfo :: Solution Patterns for Cloud Native Architectures</title>
    <link rel="canonical" href="https://redhat-solution-patterns.github.io/solution-patterns/comprehensive-service-architecture/4/04-provision-bookInfo.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () { 
      const urlParams = new URLSearchParams(window.location.search);
      const clusterName = urlParams.get('CLUSTER_WILDCARD_URL');
      const projectName = urlParams.get('PROJECT');
      if (clusterName) {
        showCluster( clusterName );
      }
      else {
        showClusterForm();
      }

      if (projectName) {
        showProject( projectName );
      } else {
        showProjectForm();
      }
    } );


    function sliceCluster(clusterName){
      if (clusterName.length > 70) {
          return "..." + clusterName.slice(35);
      } else {
          return clusterName;
      }
    }

    function showCluster( clusterName ) {
      document.getElementById('navbar-form-empty').style.display = "none";
      document.getElementById('navbar-form-filled').style.display = "flex";
      document.getElementById('cluster_subdomain').textContent = sliceCluster(clusterName);
      document.getElementById('clusterfield2').value = clusterName;

    }

    function showClusterForm( clusterName ) {
      document.getElementById('navbar-form-empty').style.display = "flex";
      document.getElementById('navbar-form-filled').style.display = "none";
    }

    function gowithcluster() {
      elClusterInput = document.getElementById('clusterfield');
      elProjectInput = document.getElementById('projectfield2');

      // Remove Project from URL query parameters
      window.location.search = ('&CLUSTER_WILDCARD_URL=' + elClusterInput.value);
      // window.location.search = ('&CLUSTER_WILDCARD_URL=' + elClusterInput.value + '&PROJECT=' + elProjectInput.value);
    }

    function showProject( projectName ) {
      document.getElementById('navbar-form-project-empty').style.display = "none";
      document.getElementById('navbar-form-project-filled').style.display = "flex";
      document.getElementById('project').textContent = projectName;
      document.getElementById('projectfield2').value = projectName;
    }

    function showProjectForm( projectName ) {
      document.getElementById('navbar-form-project-empty').style.display = "flex";
      document.getElementById('navbar-form-project-filled').style.display = "none";
    }

    function gowithproject() {
      elProjectInput = document.getElementById('projectfield');
      elClusterInput = document.getElementById('clusterfield2');
      window.location.search = ('&CLUSTER_WILDCARD_URL=' + elClusterInput.value + '&PROJECT=' + elProjectInput.value);
    }

  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://redhat-solution-patterns.github.io/" target="_blank"><img
          src="https://redhat-solution-patterns.github.io/solution-pattern-enhancing-applications/_/img/logo.png" height="40px" alt="Solution Patterns"></a>
      <a class="navbar-item" style="font-size: 14px; color: white" href="https://redhat-solution-patterns.github.io/solution-patterns">Solution Patterns for Cloud Native Architectures</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item" id="navbar-form-empty">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i style="color: orange;"
              class="fa fa-exclamation-triangle" aria-hidden="true"></i></span>

          <form action="javascript:void(0);" onsubmit="gowithcluster();">
            <input size="40" id="clusterfield" type="text" placeholder="Enter the OpenShift ingress domain value">
            <input type="hidden" id="projectfield2" name="projectfield2" value="">
          </form>
        </div>

        <div class="navbar-item" id="navbar-form-filled" style="display: none;">
          <span class="navbar-text" id="cluster_subdomain"></span>
        </div>

         <div class="navbar-item" id="navbar-form-project-empty">
          <!-- Removing the Project text field and exclamation triangle -->
          <!-- <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i style="color: orange;"
              class="fa fa-exclamation-triangle" aria-hidden="true"></i></span> -->

          <form action="javascript:void(0);" onsubmit="gowithproject();">
            <!-- <input size="40" id="projectfield" type="text" placeholder="Enter Project Name"> -->
            <input type="hidden" id="clusterfield2" name="clusterfield2" value="">
          </form>
        </div>

        <div class="navbar-item" id="navbar-form-project-filled" style="display: none;">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">|</span>
          <span class="navbar-text" id="project"></span>
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i onclick="recycle();" style="color: green;" class="fa fa-recycle" aria-hidden="true"></i></span>
        </div>

        
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Solution Patterns</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://red.ht/enhance-with-cdc" target="_blank">Adopt Change Data Capture for stack modernization</a>
            <a class="navbar-item" href="https://red.ht/enhance-with-eda" target="_blank">Enhancing Applications with Application Services</a>
          </div>
      </div>
      <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Other</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-gitops-patterns.io/" target="_blank">GitOps Solution Patterns</a>
            <a class="navbar-item" href="https://hybrid-cloud-patterns.io/" target="_blank">Hybrid Cloud Solution Patterns</a>
          </div>
      </div>
      <a class="navbar-item" href="https://www.redhat.com/en/products/middleware" target="_blank">Red Hat Application Services</a>
      <a class="navbar-item" href="https://developers.redhat.com/middleware" target="_blank">Learn more</a>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="comprehensive-service-architecture" data-version="4">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Comprehensive Service Architecture</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">1. Home page</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#use-cases">1.1 Use cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_the_story_behind_this_solution_pattern">1.2 The story behind this solution pattern</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_the_solution">1.3 The solution</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-architecture.html">2. Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#_common_challenges">2.1. Common Challenges</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#tech_stack">2.2. Technology stack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#in_depth">2.3. An in-depth look at the solution&#8217;s architecture</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-demo.html">3. See the Solution in Action</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-demo.html#_demonstration">3.1. Demonstration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-demo.html#_run_the_demonstration">3.2. Run this demonstration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-demo.html#_before_getting_started">3.3. Pre-requisites</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-demo.html#_installing_the_demo">3.4. Installing the demo</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-demo.html#_walkthrough_guide">3.5. Walkthrough guide</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://redhat-solution-patterns.github.io/">4. Other Red Hat Solution Patterns</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Comprehensive Service Architecture</span>
    <span class="version">4</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Comprehensive Service Architecture</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">4</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Comprehensive Service Architecture</a></li>
    <li><a href="04-provision-bookInfo.html">Provision BookInfo</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-servicemesh-apim-demo/rh-apim-servicemesh-solution-pattern-test/edit/master/documentation/modules/ROOT/pages/04-provision-bookInfo.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Provision BookInfo</h1>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>BookInfo Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Bookinfo is a sample microservice architecture application that we&#8217;ll be using for our workshop.The application provides details about the book such as publisher details, overview, reviews and ratings through the microservices. The BookInfo Application is deployed to bookinfo namespace</p>
</div>
<div class="sect2">
<h3 id="deploy"><a class="anchor" href="#deploy"></a>Deploy BookInfo</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create new project with the name 'bookinfo'</p>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc new-project bookinfo</code></pre>
</div>
</div>
</li>
<li>
<p>By creating a ServiceMeshMemberRoll resource and specifying the namespaces where your content is located, we can add applications, workloads, or services to your mesh .</p>
</li>
<li>
<p>Create a Custom Resource Definition file for the Control Plane with name <code>ServiceMeshMemberRoll_default.yaml</code> using vim or any other editor on the CLI. Copy paste the below yaml into the file and save it.</p>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: maistra.io/v1
kind: ServiceMeshMemberRoll
metadata:
  name: default
spec:
  members:
    - bookinfo</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the CRD to your cluster using the below command</p>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f ServiceMeshMemberRoll_default.yaml -n istio-system</code></pre>
</div>
</div>
</li>
<li>
<p>Provision the application by using the below commands.</p>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f <a href="https://raw.githubusercontent.com/maistra/istio/maistra-2.1/samples/bookinfo/platform/kube/bookinfo.yaml" class="bare">https://raw.githubusercontent.com/maistra/istio/maistra-2.1/samples/bookinfo/platform/kube/bookinfo.yaml</a> -n bookinfo
oc apply -f <a href="https://raw.githubusercontent.com/maistra/istio/maistra-2.1/samples/bookinfo/networking/bookinfo-gateway.yaml" class="bare">https://raw.githubusercontent.com/maistra/istio/maistra-2.1/samples/bookinfo/networking/bookinfo-gateway.yaml</a> -n bookinfo</code></pre>
</div>
</div>
</li>
<li>
<p>You can now verify that the bookinfo service is responding by using reqbin.</p>
</li>
<li>
<p>Open a browser window and navigate to:</p>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-weblink hljs" data-lang="weblink"><a href="https://reqbin.com/curl" class="bare">https://reqbin.com/curl</a></code></pre>
</div>
</div>
</li>
<li>
<p>Copy and paste the below command.</p>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -v <a href="http://istio-ingressgateway-istio-system.%CLUSTER_WILDCARD_URL%/productpage" class="bare">http://istio-ingressgateway-istio-system.%CLUSTER_WILDCARD_URL%/productpage</a></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>If the CLuster URL is not populated, you can also retrieve the <strong>cluster wildcard url</strong> using the below command</em></p>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get ingresscontroller default -n openshift-ingress-operator -o json | jq -r '.status.domain'</code></pre>
</div>
</div>
</li>
<li>
<p>You should see 200 (OK) status</p>
<div class="imageblock unresolved">
<div class="content">
<img src="reqbin-istio.png" alt="reqbin istio">
</div>
</div>
</li>
<li>
<p>Send the request 10 times to the product page to generate traffic</p>
</li>
<li>
<p>Open the Kiali Console with URL given below  and login using your OpenShift Cluster Credentials given to you as a part of your welcome email.</p>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-weblink hljs" data-lang="weblink"><a href="https://kiali-istio-system.%CLUSTER_WILDCARD_URL%" class="bare">https://kiali-istio-system.%CLUSTER_WILDCARD_URL%</a></code></pre>
</div>
</div>
</li>
<li>
<p>Navigate to Graph and Select all Namespaces</p>
<div class="imageblock unresolved">
<div class="content">
<img src="kiali-all-namespaces.png" alt="kiali all namespaces">
</div>
</div>
</li>
<li>
<p>You should be able to see the traffic from istio-gateway to the bookinfo application as shown below:</p>
<div class="imageblock unresolved">
<div class="content">
<img src="kiali-traffic.png" alt="kiali traffic">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="literalblock">
<div class="content">
<pre>If you are unable to see the traffic go back to the reqbin browser
and generate more traffic (Repeat steps 7 &amp; 8)</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You can also trace the calls using Jaeger if you choose to. Open the Jaeger Console with URL given below and login using your OpenShift Cluster Credentials given to you as a part of your welcome email.</p>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-weblink hljs" data-lang="weblink"><a href="https://jaeger-istio-system.%CLUSTER_WILDCARD_URL%" class="bare">https://jaeger-istio-system.%CLUSTER_WILDCARD_URL%</a></code></pre>
</div>
</div>
</li>
<li>
<p>Chose Allow selected permissions</p>
<div class="imageblock unresolved">
<div class="content">
<img src="jaeger-permission.png" alt="jaeger permission">
</div>
</div>
</li>
<li>
<p>Select the productpage.bookinfo service and click on 'Find Traces'</p>
<div class="imageblock unresolved">
<div class="content">
<img src="jaeger-service-search.png" alt="jaeger service search">
</div>
</div>
</li>
<li>
<p>Click on any of the search results and you should be able to find the traces as shown in the image below</p>
<div class="imageblock unresolved">
<div class="content">
<img src="jaeger-traces.png" alt="jaeger traces">
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>After completion please proceed to next section:</p>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <img
          src="../../_/img/app-services-logo.png" height="40px" alt="Cloud Native Architecture Solution Patterns"  href="https://redhat.com" ></a>
</footer><script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
